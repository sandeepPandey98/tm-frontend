<div class="task-list-container">
  <!-- Header with controls -->
  <div class="task-list-header">
    <h1>{{ UI_LABELS.MY_TASKS }}</h1>
    <button mat-raised-button color="primary" (click)="openTaskForm()">
      <mat-icon>add</mat-icon>
      {{ UI_LABELS.ADD_TASK }}
    </button>
  </div>

  <!-- Search and Filters with Reactive Forms -->
  <form [formGroup]="filterForm" class="task-filters">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>{{ UI_LABELS.SEARCH_TASKS }}</mat-label>
      <input matInput formControlName="search" [placeholder]="UI_LABELS.SEARCH_PLACEHOLDER" 
             (keyup.enter)="onSearchClick()">
      <button mat-icon-button matSuffix (click)="onSearchClick()" 
              [disabled]="isLoading()" 
              [attr.aria-label]="UI_LABELS.SEARCH_TASKS">
        <mat-icon>search</mat-icon>
      </button>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>{{ UI_LABELS.FILTER_BY_STATUS }}</mat-label>
      <mat-select formControlName="statusFilter" multiple>
        <mat-option *ngFor="let status of TASK_STATUS_OPTIONS" [value]="status.value">
          {{ status.label }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>{{ UI_LABELS.FILTER_BY_PRIORITY }}</mat-label>
      <mat-select formControlName="priorityFilter" multiple>
        <mat-option *ngFor="let priority of TASK_PRIORITY_OPTIONS" [value]="priority.value">
          {{ priority.label }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-button (click)="clearFilters()" *ngIf="hasActiveFilters()">
      <mat-icon>clear</mat-icon>
      {{ UI_LABELS.CLEAR_FILTERS }}
    </button>
  </form>

  <!-- Task Stats and Pagination Info -->
  <div class="task-stats">
    <div class="stats-chips">
      <mat-chip-set>
        <mat-chip [color]="'warn'" selected>
          {{ UI_LABELS.PENDING }}: {{ pendingCount() }}
        </mat-chip>
        <mat-chip [color]="'accent'" selected>
          {{ UI_LABELS.IN_PROGRESS }}: {{ inProgressCount() }}
        </mat-chip>
        <mat-chip [color]="'primary'" selected>
          {{ UI_LABELS.COMPLETED }}: {{ completedCount() }}
        </mat-chip>
      </mat-chip-set>
    </div>
    
    <div class="pagination-info" *ngIf="paginationInfo()">
      <span class="total-items">
        Total: {{ paginationInfo()!.total }} tasks
        <span *ngIf="filterForm.get('search')?.value" class="search-indicator">
          (filtered by: "{{ filterForm.get('search')?.value }}")
        </span>
      </span>
      <span class="page-info">
        Page {{ paginationInfo()!.current }} of {{ paginationInfo()!.pages }}
      </span>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div class="loading-container" *ngIf="isLoading()">
    <mat-spinner diameter="40"></mat-spinner>
    <p>{{ UI_LABELS.LOADING_TASKS }}</p>
  </div>

  <!-- Task List using Signals -->
  <div class="tasks-grid" *ngIf="!isLoading()">
    <app-task-item 
      *ngFor="let task of displayedTasks()" 
      [task]="task"
      (taskUpdated)="onTaskUpdated($event)"
      (taskDeleted)="onTaskDeleted($event)"
      (editTask)="openTaskForm($event)">
    </app-task-item>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="displayedTasks().length === 0">
      <mat-icon class="empty-icon">assignment</mat-icon>
      <h3>{{ UI_LABELS.NO_TASKS_FOUND }}</h3>
      <p *ngIf="!hasActiveFilters()">
        {{ UI_LABELS.NO_TASKS_MESSAGE }}
      </p>
      <p *ngIf="hasActiveFilters()">
        {{ UI_LABELS.NO_TASKS_FILTERED }}
      </p>
      <button mat-raised-button color="primary" (click)="openTaskForm()">
        <mat-icon>add</mat-icon>
        {{ UI_LABELS.CREATE_TASK }}
      </button>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="!isLoading() && displayedTasks().length > 0">
    <mat-paginator
      [length]="totalItems()"
      [pageSize]="pageSize()"
      [pageIndex]="currentPage() - 1"
      [pageSizeOptions]="PAGINATION_OPTIONS.PAGE_SIZE_OPTIONS"
      [showFirstLastButtons]="PAGINATION_OPTIONS.SHOW_FIRST_LAST_BUTTONS"
      (page)="onPageChange($event)"
      aria-label="Select page">
    </mat-paginator>
  </div>

  <!-- Task Form Modal using Signals -->
  <app-task-form 
    *ngIf="showTaskForm()"
    [task]="editingTask()"
    (taskSaved)="onTaskSaved($event)"
    (cancelled)="closeTaskForm()">
  </app-task-form>

  <!-- Confirmation Modal -->
  <app-confirmation-modal 
    *ngIf="confirmationModalService.showModal()"
    [data]="confirmationModalService.modalData()!"
    (confirmed)="confirmationModalService.onConfirmed()"
    (cancelled)="confirmationModalService.onCancelled()">
  </app-confirmation-modal>
</div>
